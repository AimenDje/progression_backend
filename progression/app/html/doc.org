#+SETUPFILE: https://portail.dti.crosemont.quebec/org-html-themes/org/theme-readtheorg.setup
#+TITLE: API Progression
#+PROPERTY: header-args:sh :results output
#+PROPERTY: header-args:sh :exports both

* Versions
Les versions de l'api sont accessibles à des URL distincts pour assurer la rétrocompatibilité.

| Version | URL        |
|       1 | ~/api/v1/~ |

* Points d'entrée
** Publics
| Méthode | URL     | Description      | Paramètres         | Réponse             |
| GET     | ~/doc~  | Documentation    |                    | str (HTML)          |
| POST    | ~/auth~ | Authentification | username, password | token, un token JWT |

** Privés
Les points d'entrée privés requierent un token dans l'entête : «Authentification: Bearer <token>»

| Méthode | URL                | Description                      | Réponse                          |
| GET     | ~/user/{username}~ | Obtient l'utilisateur /username/ | User,  l'utilisateur authentifié |

* Objets
| Classe                       | Identifiant              | Propriétés      | Type      |                          Valeurs | Liens           |
|------------------------------+--------------------------+-----------------+-----------+----------------------------------+-----------------|
| /                            | <                        |                 |           |                                  | <               |
| User                         | username                 | username        | str       |                                  | catégories      |
|                              |                          | rôle            | int       |                         0=normal |                 |
|                              |                          |                 |           |                          1=admin |                 |
|------------------------------+--------------------------+-----------------+-----------+----------------------------------+-----------------|
| Catégorie                    | parent/nom               | nom             | str       |                                  | parent          |
|                              |                          | titre           | str       |                                  | sous-catégories |
|                              |                          | description     | str       |                                  | questions       |
|                              |                          | numéro          | int       |                                  |                 |
|                              |                          | avancement      | float     |                           0-100% |                 |
|                              |                          | accessible      | bool      |                                  |                 |
|------------------------------+--------------------------+-----------------+-----------+----------------------------------+-----------------|
| Question                     | catégorie/nom            | nom             | str       |                                  | suivante        |
| ▲                            |                          | titre           | str       |                                  | catégorie       |
| │                            |                          | description     | str       |                                  | ébauches        |
| │                            |                          | numéro          | int       |                                  | tests           |
| │                            |                          | énoncé          | str       |                                  | solutions       |
| │                            |                          | avancement      | int       | DÉBUT(0),NON-RÉUSSI(1),RÉUSSI(2) |                 |
| │                            |                          | type            | int       |                                  |                 |
| ├ QuestionProg               |                          |                 |           |                                3 |                 |
| ├ QuestionProgEval(obsolète) |                          |                 |           |                                0 |                 |
| ├ QuestionSys                |                          |                 |           |                                1 |                 |
| └ QuestionBD                 |                          |                 |           |                                2 |                 |
|                              |                          | image           | str       |                           SHA256 |                 |
|                              |                          | user            | str       |                                  |                 |
|                              |                          | vérification    | str       |                                  |                 |
|------------------------------+--------------------------+-----------------+-----------+----------------------------------+-----------------|
| Solution                     | question/date_soumission | date_soumission | timestamp |                                  | question        |
|                              |                          | langage         | int       |                                  |                 |
|                              |                          | code            | str       |                                  |                 |
|                              |                          | feedback        | str       |                                  |                 |
|------------------------------+--------------------------+-----------------+-----------+----------------------------------+-----------------|
| Test                         | question/numéro          | numéro          | int       |                                  | question        |
|                              |                          | nom             | str       |                                  |                 |
|                              |                          | entrée          | str       |                                  |                 |
|                              |                          | sortie_attendue | str       |                                  |                 |
|                              |                          | sortie_observée | str       |                                  |                 |
|                              |                          | sortie_erreur   | str       |                                  |                 |
|                              |                          | résultat        | bool      |                                  |                 |
|                              |                          | feedback        | str       |                                  |                 |

* Exemples

#+NAME: extract_token
#+BEGIN_SRC sh :var token="" :export no :results output
echo $token | cut -d '"' -f 4
#+END_SRC

#+NAME: get_token
#+BEGIN_SRC sh :eval :post extract_token(token=*this*) :results output :export no
PASSWORD=$(cat ~/mot_de_passe)
curl https://progression.dti.crosemont.quebec/api/v1/auth --data "username=bob&password=$PASSWORD" 
#+END_SRC

** Connexion en tant qu'utilisateur ~bob~ :


#+BEGIN_SRC sh :eval :results output
PASSWORD=$(cat ~/mot_de_passe)
curl https://progression.dti.crosemont.quebec/api/v1/auth --data "username=bob&password=$PASSWORD" 
#+END_SRC

#+RESULTS:
: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjc1NDczOCwiZXhwaXJlZCI6MTYxMjg0MTEzOH0.fOzl57wzxQh1HmAClHDzGJo4dLcMZfOxmqW9bGHlAP8

** Obtenir le profil de l'utilisateur connecté ~bob~ : 

#+BEGIN_SRC sh :var TOKEN=get_token :results output
curl https://progression.dti.crosemont.quebec/api/v1/user -H "Authorization: Bearer $TOKEN"
#+END_SRC

#+RESULTS:
#+begin_example
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
<hr>
<address>Apache/2.4.25 (Debian) Server at ic.dti.crosemont.quebec Port 443</address>
</body></html>
#+end_example

** Obtenir la liste des catégories disponibles pour ~bob~ :

#+BEGIN_SRC sh :eval never
curl https://progression.dti.crosemont.quebec/api/v1/user/bob?links -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjczNTgwMiwiZXhwaXJlZCI6MTYxMjgyMjIwMn0.d3X4qWXi1bAIrlwyk37grM-KzO0S0gmIc3NUYK-KseM" 
#+END_SRC


** Obtenir la catégorie «prog_1» :

#+BEGIN_SRC sh :eval never
curl https://progression.dti.crosemont.quebec/api/v1/categorie/prog_1&links -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjczNTgwMiwiZXhwaXJlZCI6MTYxMjgyMjIwMn0.d3X4qWXi1bAIrlwyk37grM-KzO0S0gmIc3NUYK-KseM" 
#+END_SRC


** Obtenir la question «fonction_42» :

#+BEGIN_SRC sh :eval never
curl https://progression.dti.crosemont.quebec/api/v1/question/prog_1/les_fonctions/fonction_42 -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjczNTgwMiwiZXhwaXJlZCI6MTYxMjgyMjIwMn0.d3X4qWXi1bAIrlwyk37grM-KzO0S0gmIc3NUYK-KseM" 
#+END_SRC

** Obtenir l'ébauche de solution en Python pour question «fonction_42» :

#+BEGIN_SRC sh :eval never
curl https://progression.dti.crosemont.quebec/api/v1/solution/prog_1/les_fonctions/fonction_42?langage=python -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjczNTgwMiwiZXhwaXJlZCI6MTYxMjgyMjIwMn0.d3X4qWXi1bAIrlwyk37grM-KzO0S0gmIc3NUYK-KseM" 
#+END_SRC

** Soumettre une solution à la question «fonction_42» :

#+BEGIN_SRC sh :eval never
curl --data '{"langage":"python", "code":"print (\"Allo le monde\")"  }' https://progression.dti.crosemont.quebec/api/v1/solution/prog_1/les_fonctions/fonction_42 -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjp7InVzZXJuYW1lIjoicGxhZnJhbmNlIiwicm9sZSI6MCwiaWQiOjEsImFjdGlmIjpudWxsfSwiY3VycmVudCI6MTYxMjczNTgwMiwiZXhwaXJlZCI6MTYxMjgyMjIwMn0.d3X4qWXi1bAIrlwyk37grM-KzO0S0gmIc3NUYK-KseM" 
#+END_SRC





















